<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>はやわかりtree-sitter</title>
    <style>
      .reveal aside {
        display: none !important;
      }
      .reveal h1, .reveal h2, .reveal h3, .reveal h4, .reveal h5, .reveal h6 {
        text-transform: none !important;
      }
    </style>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section class="front"><header><h1>はやわかり<br/>tree-sitter</h1><small>Kyoto.* #4 (2018-08-18)</small></header></section><section><h2>tree-sitterとは</h2><p><a href="https://github.com/tree-sitter/tree-sitter">https://github.com/tree-sitter/tree-sitter</a></p><ul><li>パーサージェネレーターの一種</li><li>なるほど？</li><li>ところでパーサージェネレーターとは…</li></ul></section><section><h2>そのまえにパーサーとは</h2><p>決まった文法に従って文字列を解釈するやつ</p><p>たとえば<ul><li>なんかのソースコード</li><li>なんかの設定ファイル</li><li>コマンドライン引数</li></ul><br/>とかのパーサーを毎日使ってるはず</p></section><section><ul><li>パーサーを手書きするのは大変<ul><li>あっという間にメンテ不能になる</li><li>効率のよい実装にするのも大変</li></ul></li><li>文法を渡してあげるとパーサーを生成してくれるもの＝パーサージェネレーター<li>bison, ANTLR, <b>tree-sitter</b>など</li></li></ul></section><section><h2>tree-sitterとは</h2><ul><li>パーサージェネレーターの一種</li><li><q>An incremental parsing system</q><ul><li>パース→ソースコード編集→再パース</li><li>高速に再パースできる</li></ul></li></ul></section><section><h3>特徴</h3><ul><li>文法はJSで定義する<ul><li>独自DSLではない</li><li>JSならだいたいみんな読める</li></ul></li><li>出力されるパーサーのコードはC言語<ul><li>ポータビリティを重視してるっぽい</li></ul></li></ul></section><section><h3>利用例</h3><ul><li>Atomで採用されている</li><ul><li>（Atomのために開発されてる感がある）</li><li>シンタックスハイライト</li><li>インデント</li><li>ブロックを畳む機能などなど</li><li>Atom 1.2.5 betaからopt-inで使える</li><li>詳細は“site:blog.atom.io tree-sitter“で検索</li></ul></ul></section><section><h2>パーサーを作ってみる</h2><ul><li>四則演算の文法</li><ul><li>自然数 (0, 1, 2, …)</li><li>整数 (..., -2, -1, 0, 1, 2, …)</li><li>足し算・引き算</li><li>掛け算・割り算</li><li>かっこ</li></ul><p><a href="https://github.com/vzvu3k6k/tree-sitter-simple-arithmetic">https://github.com/vzvu3k6k/tree-sitter-simple-arithmetic</a></p></ul></section><section><h3>はじめの手順</h3><ol><li><code>npm init && npm install -D tree-sitter-cli</code></li><li>適当に<code>grammar.js</code>を書く</li><li><code>npx tree-sitter generate</code>(パーサーのコードとかを出力）</li><li><code>npm install</code>（パーサーをビルドするための設定＋実際のビルド）</li><li><code>npx tree-sitter parser ./source</code>で動作確認</li></ol></section><section><h3>開発手順</h3><ol><li><code>grammar.js</code>を更新する</li><li><code>npx tree-sitter generate && npx node-gyp build</code></li><li>動作確認<ul><li><code>npx tree-sitter test</code></li><li><code>npx tree-sitter parser ./source -d</code></li></ul></li></ol></section><section><h3>ポイント</h3><ul><li>テストも書ける</li><ul><li>パースエラーもテストできる</li><li>エラー回復込みのテストを書く必要があるっぽい</li></ul><li>generateしてからbuildする必要がある<ul><li>package.jsonとかMakefileとかでコマンド一発でテスト実行できるようにすると楽</li></ul></li></ul></section><section><h3>パーサーを動かしてみる</h3><ul><li>JavaScript, Rust, Haskell, Rubyとかのバインディングがある<ul><li>JavaScriptのバインディングがいちばん整備されてる</li><li>READMEのサンプルを10行ぐらいコピペするだけで動かせるのでおすすめ</li></ul></li></ul></section><section><h3>Atomに組み込んでみる</h3><p><a href="https://github.com/vzvu3k6k/language-simple-arithmetic">https://github.com/vzvu3k6k/language-simple-arithmetic</a></p><ul><li>Atomではpackageをインストールすると機能を拡張できる。</li><li>各言語のシンタックスハイライトとかもpackageとして提供されている。</li></ul></section><section><h3>Atomに組み込んでみる</h3><ul><li>従来の言語サポートはTextMateのgrammarの仕組みを使っている。</li><li>tree-sitterを利用する方法は公式のドキュメントには載ってない。</li><li>Atomにバンドルされているtree-sitterのバージョンに合わせる必要がある。</li></ul></section><section><h3>まとめ</h3><ul><li>エディタ用のパーサーは意外と簡単につくれる</li><ul><li>JavaScriptのパーサー（<a href="https://github.com/tree-sitter/tree-sitter-javascript/blob/master/grammar.js">tree-sitter-javascript</a>）も1000行未満</li><li>でも言語処理系で使うのは難しそう</li></ul><li>Atomがんばってくれ</li></ul></section><section><h2>おすすめのリソース</h2><ul><li>tree-sitterの文法定義チュートリアル<ul><li><a href="https://gist.github.com/Aerijo/df27228d70c633e088b0591b8857eeef">https://gist.github.com/Aerijo/df27228d70c633e088b0591b8857eeef</a></li></ul></li><li>tree-sitterの開発チームのプレゼン<ul><li><a href="https://www.youtube.com/watch?v=0CGzC_iss-8">https://www.youtube.com/watch?v=0CGzC_iss-8</a></li><li><a href="https://www.youtube.com/watch?v=a1rC79DHpmY">https://www.youtube.com/watch?v=a1rC79DHpmY</a></li><li>字幕付いてるしスライドもわかりやすいので雰囲気をつかむのにおすすめ</li></ul></li></ul></section><section><h2>あわせて読みたい</h2><ul><li>Optimizations in Syntax Highlighting, a Visual Studio Code Story<ul><li><a href="https://code.visualstudio.com/blogs/2017/02/08/syntax-highlighting-optimizations">https://code.visualstudio.com/blogs/2017/02/08/syntax-highlighting-optimizations</a><ul><li>VS Codeのsyntax highlightを最適化したりしたときの苦労話</li><li>Atomと同じくTextMateのgrammarファイルを使ってる</li></ul></li></ul></li></ul></section>
      </div>
    </div>
  <script type="text/javascript" src="index_bundle.js"></script></body>
</html>
